(function(e){function t(t){for(var a,i,r=t[0],l=t[1],c=t[2],p=0,u=[];p<r.length;p++)i=r[p],Object.prototype.hasOwnProperty.call(n,i)&&n[i]&&u.push(n[i][0]),n[i]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);d&&d(t);while(u.length)u.shift()();return o.push.apply(o,c||[]),s()}function s(){for(var e,t=0;t<o.length;t++){for(var s=o[t],a=!0,r=1;r<s.length;r++){var l=s[r];0!==n[l]&&(a=!1)}a&&(o.splice(t--,1),e=i(i.s=s[0]))}return e}var a={},n={app:0},o=[];function i(t){if(a[t])return a[t].exports;var s=a[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=a,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(s,a,function(t){return e[t]}.bind(null,a));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/bitrix/components/ithive.goalsbazhen/edit.card.rating/templates/.default/vue_app/dist/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=t,r=r.slice();for(var c=0;c<r.length;c++)t(r[c]);var d=l;o.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"56d7":function(e,t,s){"use strict";s.r(t);s("e260"),s("e6cf"),s("cca6"),s("a79d");var a=s("2b0e"),n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("form",{staticClass:"slider-form",attrs:{method:"post",name:"sliderForm"}},[s("input",{staticClass:"slider-field",attrs:{type:"hidden",value:"",name:"ID"}}),s("head-title"),s("head-stages"),s("div",{staticClass:"form-tabs"},[s("span",{staticClass:"form-tabs-span",class:{"form-tabs-span-active":"goals"===e.activeTab},on:{click:function(t){e.activeTab="goals"}}},[e._v(e._s(e.localize.RATING))]),s("span",{staticClass:"form-tabs-span",class:{"form-tabs-span-active":"history"===e.activeTab},on:{click:function(t){e.activeTab="history"}}},[e._v(e._s(e.localize.HISTORY))])]),"goals"===e.activeTab?s("div",{staticClass:"form-container"},[s("head-info"),s("rating-table"),s("history")],1):e._e(),"history"===e.activeTab?s("div",{staticClass:"form-container"},[s("logs")],1):e._e(),e.canEdit?[e.isDraftStage?s("div",{staticClass:"button-line"},[s("button",{staticClass:"btn-submit",class:{"btn-submit-cancel":!e.canSubmit},attrs:{type:"button",disabled:!e.canSubmit},on:{click:function(t){return e.sendAgreement()}}},[e._v(e._s(e.localize.SEND_AGREE))]),s("button",{staticClass:"btn-cancel",attrs:{type:"button"},on:{click:function(t){return e.closeSlider()}}},[e._v(e._s(e.localize.DECLINE))])]):e.isAgreementAdmin?s("div",{staticClass:"button-line"},[s("button",{staticClass:"btn-submit",attrs:{type:"button"},on:{click:function(t){return e.sendAgreement()}}},[e._v(e._s(e.localize.APPROVE))]),s("button",{staticClass:"btn-return",attrs:{type:"button"},on:{click:function(t){return e.openModalComment()}}},[e._v(e._s(e.localize.NOT_APPROVE))]),s("button",{staticClass:"btn-cancel",attrs:{type:"button"},on:{click:function(t){return e.closeSlider()}}},[e._v(e._s(e.localize.DECLINE))])]):s("div",{staticClass:"button-line"},[s("button",{staticClass:"btn-submit",class:{"btn-submit-cancel":e.progressChange},attrs:{type:"button",disabled:e.progressChange},on:{click:function(t){return e.sendAgreement()}}},[e._v(e._s(e.localize.AGREE))]),s("button",{staticClass:"btn-return",attrs:{type:"button"},on:{click:function(t){return e.openModalComment()}}},[e._v(e._s(e.localize.NOT_AGREE))]),s("button",{staticClass:"btn-cancel",attrs:{type:"button"},on:{click:function(t){return e.closeSlider()}}},[e._v(e._s(e.localize.DECLINE))])]),s("div",{staticStyle:{display:"none"},attrs:{id:"commentPopup"}},[e.isAdmin?s("select",{directives:[{name:"model",rawName:"v-model",value:e.stageToChange,expression:"stageToChange"}],staticClass:"block-process-table-select",staticStyle:{"margin-bottom":"15px"},on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.stageToChange=t.target.multiple?s:s[0]}}},[s("option",{attrs:{value:"",selected:"",disabled:""}},[e._v(e._s(e.localize.SELECT_STAGE))]),e._l(e.statusGoals,(function(t){return t.sort<e.activeSort?s("option",{domProps:{value:t.id}},[e._v(e._s(t.value))]):e._e()}))],2):e._e(),s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.comment,expression:"comment"}],staticClass:"comment-area",attrs:{rows:"5",placeholder:e.localize.COMMENT},domProps:{value:e.comment},on:{input:function(t){t.target.composing||(e.comment=t.target.value)}}}),s("button",{staticClass:"btn-submit",attrs:{type:"button"},on:{click:function(t){return e.sendDecline()}}},[e._v(e._s(e.localize.SEND))])])]:e._e()],2)])},o=[],i=s("5530"),r=(s("dca8"),s("07ac"),s("4e82"),s("d3b7"),s("159b"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"form-title"},[s("span",{staticClass:"form-title-label"},[e._v(e._s(e.localize.GOALS_EMPLOYEE)+" "+e._s(e.userInfo.NAME))])])}),l=[],c=s("2f62"),d={name:"HeadTitle",props:{title:String},computed:Object(i["a"])(Object(i["a"])({},Object(c["b"])(["userInfo"])),{},{localize:function(){return Object.freeze({GOALS_EMPLOYEE:BX.message("GOALS_EMPLOYEE")})}})},p=d,u=s("2877"),m=Object(u["a"])(p,r,l,!1,null,null,null),g=m.exports,_=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"crm-entity-section-status-container-flex"},e._l(e.statusGoals,(function(t,a){return s("div",{key:"status_goal_"+a,staticClass:"crm-entity-section-status-step"},[s("div",{staticClass:"crm-entity-section-status-step-item"},[s("div",{staticClass:"crm-entity-section-status-step-item-text",style:{borderImage:t.background,color:t.color},attrs:{"data-base-color":"#00C4FB"}},[e._v(" "+e._s(t.value)+" ")])])])})),0)},b=[],v={name:"HeadStages",computed:Object(i["a"])({},Object(c["b"])(["statusGoals"]))},f=v,E=Object(u["a"])(f,_,b,!1,null,null,null),h=E.exports,C=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"block-process"},[s("div",{staticClass:"title-block-process"},[e._v(e._s(e.localize.ABOUT_PROCESS))]),s("div",{staticClass:"block-process-info"},[s("div",{staticClass:"sub-block-info-user"},[s("span",{staticClass:"sub-block-info-title"},[e._v(e._s(e.localize.ASSESSED))]),s("div",{staticClass:"sub-block-info-employee"},[e.userInfo.ICON?s("div",{staticClass:"sub-block-info-inline"},[s("img",{staticClass:"sub-block-info-icon",attrs:{src:e.userInfo.ICON}})]):e._e(),s("div",{staticClass:"sub-block-info-inline"},[s("span",{staticClass:"sub-block-info-name"},[s("a",{attrs:{href:"/company/personal/user/"+e.userInfo.ID+"/"}},[e._v(e._s(e.userInfo.NAME))])]),s("span",{staticClass:"sub-block-info-position"},[e._v(e._s(e.userInfo.POSITION))]),s("span",{staticClass:"sub-block-info-department"},[e._v(e._s(e.userInfo.DEPARTMENT))])])])]),s("div",{staticClass:"sub-block-info"},e._l(e.processInfo,(function(e,t){return s("disable-input",{key:"process_info_"+t,attrs:{title:e.title,value:e.value}})})),1),s("div",{staticClass:"sub-block-progress"},[s("div",{staticClass:"sub-block-progress-row"},[s("span",[e._v(e._s(e.localize.TIME_PROCESS))]),s("div",{staticClass:"line-default"},[s("div",{staticClass:"line-progress",style:"width: "+(e.progressTime<0?0:e.progressTime>100?100:e.progressTime)+"%"}),s("span",{staticClass:"line-progress-value"},[e._v(e._s(e.progressTime<0?0:e.progressTime>100?100:e.progressTime)+"%")])])]),s("div",{staticClass:"sub-block-progress-row"},[s("span",[e._v(e._s(e.localize.PROGRESS_PROCESS))]),s("div",{staticClass:"line-default"},[s("div",{staticClass:"line-progress",style:"width: "+(e.progressValue>100?100:e.progressValue)+"%"}),s("span",{staticClass:"line-progress-value"},[e._v(e._s(e.progressValue>100?100:e.progressValue)+"%")])])])])])])},S=[],T=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"sub-block-info-element"},[s("span",{staticClass:"sub-block-info-title"},[e._v(e._s(e.title))]),s("input",{staticClass:"sub-block-info-value",attrs:{disabled:"disabled"},domProps:{value:e.value}})])},O=[],I={name:"DisableInput",props:{title:String,value:String}},A=I,P=Object(u["a"])(A,T,O,!1,null,null,null),w=P.exports,y={name:"HeadInfo",components:{DisableInput:w},computed:Object(i["a"])(Object(i["a"])({},Object(c["b"])(["processInfo","userInfo","progressTime","progressValue"])),{},{localize:function(){return Object.freeze({ABOUT_PROCESS:BX.message("ABOUT_PROCESS"),ASSESSED:BX.message("ASSESSED"),TIME_PROCESS:BX.message("TIME_PROCESS"),PROGRESS_PROCESS:BX.message("PROGRESS_PROCESS")})}})},M=y,R=Object(u["a"])(M,C,S,!1,null,null,null),N=R.exports,k=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"block-process"},[s("div",{staticClass:"main-grid-fade main-grid-fade-right main-grid-fade-left"},[s("div",{staticClass:"main-grid-container"},[s("div",{staticClass:"block-process-info"},[s("table",{staticClass:"block-process-table"},[s("tr",[s("td",{staticClass:"block-process-table-head",staticStyle:{width:"10%"}},[e._v(e._s(e.localize.TYPE_GOALS))]),s("td",{staticClass:"block-process-table-head",staticStyle:{width:"20%"}},[e._v(e._s(e.localize.GOAL))]),s("td",{staticClass:"block-process-table-head",staticStyle:{width:"20%"}},[e._v(e._s(e.localize.CRITERION))]),s("td",{staticClass:"block-process-table-head",staticStyle:{width:"10%"}},[e._v(e._s(e.localize.WEIGHT))]),s("td",{staticClass:"block-process-table-head",staticStyle:{width:"15%"}},[e._v("Файл цели")]),e.isLast?s("td",{staticClass:"block-process-table-head",staticStyle:{width:"15%"}},[e._v("Файл оценки")]):e._e(),s("td",{staticClass:"block-process-table-head",staticStyle:{width:"20%"}},[e._v("Зависит от")]),s("td",{staticClass:"block-process-table-head",staticStyle:{width:"10%"}},[e._v(e._s(e.localize.PREV_PROGRESS))]),e.percentSelectOptions?s("td",{staticClass:"block-process-table-head",staticStyle:{width:"10%","min-width":"10%"}},[e._v(e._s(e.localize.PROGRESS))]):e._e(),e.percentSelectOptions?e._e():s("td",{staticClass:"block-process-table-head",staticStyle:{width:"333px","min-width":"333px"}},[e._v(e._s(e.localize.PROGRESS))]),e.canViewEmployeeComment?s("td",{staticClass:"block-process-table-head",staticStyle:{width:"10%"}},[e._v(e._s(e.localize.COMMENT_EMPLOYEE))]):e._e(),e.canViewHeadComment?s("td",{staticClass:"block-process-table-head",staticStyle:{width:"10%"}},[e._v(e._s(e.localize.COMMENT_HEAD))]):e._e(),e.canViewFuncHeadComment?s("td",{staticClass:"block-process-table-head",staticStyle:{width:"10%"}},[e._v(e._s(e.localize.COMMENT_FUNC_HEAD))]):e._e(),e.canViewAdminComment?s("td",{staticClass:"block-process-table-head",staticStyle:{width:"10%"}},[e._v(e._s(e.localize.COMMENT_ADMIN))]):e._e()]),e._l(e.rating,(function(t,a){return s("tr",{key:"goal_"+a},[s("td",{staticClass:"block-process-table-column"},[s("span",[e._v(e._s(t.type_goal))])]),t.task.length>0?s("td",{staticClass:"block-process-table-column"},[s("p",{staticStyle:{"max-height":"100px","overflow-y":"auto"}},[e._v(" "+e._s(t.task)+" ")])]):s("td",{staticClass:"block-process-table-column"},[s("span",[e._v(e._s(t.goal))])]),s("td",{staticClass:"block-process-table-column"},[s("p",{staticStyle:{"max-height":"100px","overflow-y":"auto"}},[e._v(" "+e._s(t.criterion)+" ")])]),s("td",{staticClass:"block-process-table-column"},[s("span",[e._v(e._s(t.weight))])]),s("td",{staticClass:"block-process-table-column"},[t.file_goals?s("div",[s("a",{staticClass:"block-process-file-img",attrs:{title:t.file_goals.name,href:t.file_goals.path,target:"_blank"}})]):e._e()]),e.isLast?s("td",{staticClass:"block-process-table-column"},[t.file_rating?s("div",[s("a",{staticClass:"block-process-file-img",attrs:{title:t.file_rating.name,href:t.file_rating.path,target:"_blank"}}),s("span",{key:"rating_file_delete_"+a,staticClass:"block-process-file-delete",on:{click:function(t){return e.deleteFile(a)}}},[e._v("x")])]):s("div",[s("label",{staticClass:"block-process-file-text",attrs:{for:"rating_file_"+a}},[e._v("Прикрепить")]),s("input",{key:"rating_file_"+a,staticStyle:{display:"none"},attrs:{id:"rating_file_"+a,type:"file"},on:{change:function(t){return e.loadFile(t,a)}}})])]):e._e(),s("td",{staticClass:"block-process-table-column"},[s("div",{attrs:{id:t.signature}},[e._m(0,!0)])]),s("td",{staticClass:"block-process-table-column"},[s("span",[e._v(e._s(t.progressPrev))])]),s("td",{staticClass:"block-process-table-column"},[t.progress<0||t.progress>e.maxPercent?s("span",{staticStyle:{"font-size":"11px",color:"red"}},[e._v("Значение (от 0 до "+e._s(e.maxPercent)+")")]):e._e(),t.progress<t.progressPrev?s("span",{staticStyle:{"font-size":"11px",color:"red"}},[e._v(e._s(e.localize.INCORRECT_VALUE))]):e._e(),!0===e.canSelectPercentOptions?s("div",[s("div",{staticClass:"block_process_table_switcher_container"},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.progress,expression:"ratingItem.progress"}],staticClass:"block_process_table_switcher_container__select",class:{"block-process-weight-value-error-select":!t.progress||t.progress<0||t.progress>e.maxPercent||t.progress<t.progressPrev},staticStyle:{visibility:"visible"},on:{change:function(s){var a=Array.prototype.filter.call(s.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(t,"progress",s.target.multiple?a:a[0])}}},[s("option",{attrs:{value:"",selected:""}},[e._v("-")]),e._l(e.percentSelectOptions,(function(t,a){return s("option",{key:"goal_"+a},[e._v(e._s(e.percentSelectOptions[a]))])}))],2),s("label",{staticClass:"switch"},[s("input",{attrs:{type:"checkbox","data-active-mode":"select"},on:{change:function(t){return e.changePercentInputType(a)}}}),s("span",{staticClass:"slider round"})]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.progress,expression:"ratingItem.progress"}],staticClass:"block_process_table_switcher_container__input block-process-table-input",class:{"block-process-weight-value-error":!t.progress||t.progress<0||t.progress>e.maxPercent||t.progress<t.progressPrev},staticStyle:{visibility:"hidden"},attrs:{type:"number"},domProps:{value:t.progress},on:{input:function(s){s.target.composing||e.$set(t,"progress",s.target.value)}}})])]):e._e(),!0!==e.canSelectPercentOptions?s("div",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.progress,expression:"ratingItem.progress"}],staticClass:"block-process-table-input",class:{"block-process-weight-value-error":!t.progress||t.progress<0||t.progress>e.maxPercent||t.progress<t.progressPrev},attrs:{type:"number"},domProps:{value:t.progress},on:{input:function(s){s.target.composing||e.$set(t,"progress",s.target.value)}}})]):e._e()]),e.canViewEmployeeComment?s("td",{staticClass:"block-process-table-column"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.commentEmployee,expression:"ratingItem.commentEmployee"}],staticClass:"block-process-table-textarea",class:{"block-process-weight-value-error":0===t.commentEmployee.length},attrs:{disabled:!e.isDraftStage},domProps:{value:t.commentEmployee},on:{input:function(s){s.target.composing||e.$set(t,"commentEmployee",s.target.value)}}})]):e._e(),e.canViewHeadComment?s("td",{staticClass:"block-process-table-column"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.commentHead,expression:"ratingItem.commentHead"}],staticClass:"block-process-table-textarea",class:{"block-process-weight-value-error":parseInt(t.progress)!==parseInt(t.progressBeforeUpdate)&&0===t.commentHead.length&&e.isAgreementHead},attrs:{disabled:!e.isAgreementHead},domProps:{value:t.commentHead},on:{input:function(s){s.target.composing||e.$set(t,"commentHead",s.target.value)}}})]):e._e(),e.canViewFuncHeadComment?s("td",{staticClass:"block-process-table-column"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.commentFuncHead,expression:"ratingItem.commentFuncHead"}],staticClass:"block-process-table-textarea",class:{"block-process-weight-value-error":parseInt(t.progress)!==parseInt(t.progressBeforeUpdate)&&0===t.commentFuncHead.length&&e.isAgreementFuncHead},attrs:{disabled:!e.isAgreementFuncHead},domProps:{value:t.commentFuncHead},on:{input:function(s){s.target.composing||e.$set(t,"commentFuncHead",s.target.value)}}})]):e._e(),e.canViewAdminComment?s("td",{staticClass:"block-process-table-column"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.commentAdmin,expression:"ratingItem.commentAdmin"}],staticClass:"block-process-table-textarea",domProps:{value:t.commentAdmin},on:{input:function(s){s.target.composing||e.$set(t,"commentAdmin",s.target.value)}}})]):e._e()])})),s("tr",{staticStyle:{"border-top":"1px solid #E7E7E7","border-bottom":"1px solid #E7E7E7"}},[s("td",{staticClass:"block-process-weight-title",attrs:{colspan:"6"}},[e._v(e._s(e.localize.TOTAL))]),s("td",{staticClass:"block-process-weight-value",staticStyle:{"text-align":"center"}},[e._v(e._s(e.totalProgressOld))]),s("td",{staticClass:"block-process-weight-value"},[e._v(e._s(e.totalProgress))])])],2)])])])])},B=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("span",{staticClass:"ui-tile-selector-selector-wrap"},[s("span",{staticClass:"ui-tile-selector-select",attrs:{"data-role":"tile-select"}},[e._v("Добавить")])])}],x=(s("b680"),s("b0c0"),{name:"RatingTable",computed:Object(i["a"])(Object(i["a"])({},Object(c["b"])(["rating","cardId","isAdmin","isDraftStage","isAgreementHead","isAgreementFuncHead","isAgreementAdmin","progressValue","maxPercent","isLast","canSelectPercentOptions","percentSelectOptions"])),{},{localize:function(){return Object.freeze({TYPE_GOALS:BX.message("TYPE_GOALS"),GOAL:BX.message("GOAL"),CRITERION:BX.message("CRITERION"),WEIGHT:BX.message("WEIGHT"),PREV_PROGRESS:BX.message("PREV_PROGRESS"),PROGRESS:BX.message("PROGRESS"),COMMENT_EMPLOYEE:BX.message("COMMENT_EMPLOYEE"),COMMENT_HEAD:BX.message("COMMENT_HEAD"),COMMENT_FUNC_HEAD:BX.message("COMMENT_FUNC_HEAD"),COMMENT_ADMIN:BX.message("COMMENT_ADMIN"),TOTAL:BX.message("TOTAL"),INCORRECT_VALUE:BX.message("INCORRECT_VALUE"),SET_INPUT_PERCENT_MODE:BX.message("SET_INPUT_PERCENT_MODE")})},totalProgress:function(){var e=0;return this.rating.forEach((function(t){var s=parseInt(t.progress)&&!isNaN(parseInt(t.progress))?parseInt(t.progress):0,a=parseInt(t.weight)||!isNaN(parseInt(t.weight))?parseInt(t.weight):0;e+=a/100*s})),e.toFixed(2)},totalProgressOld:function(){var e=0;return this.rating.forEach((function(t){e+=parseInt(t.progressPrev)?parseInt(t.progressPrev)*(parseInt(t.weight)/100):0})),e.toFixed(2)},canViewEmployeeComment:function(){if(this.isDraftStage)return!0;var e=!1;return this.rating.forEach((function(t){t.commentEmployee.length>0&&(e=!0)})),e},canViewHeadComment:function(){var e=!1;return!!this.isAgreementHead||(this.rating.forEach((function(t){t.commentHead.length>0&&(e=!0)})),e)},canViewFuncHeadComment:function(){var e=!1;return!!this.isAgreementFuncHead||(this.rating.forEach((function(t){t.commentFuncHead.length>0&&(e=!0)})),e)},canViewAdminComment:function(){var e=!1;return!!this.isAgreementAdmin||(this.rating.forEach((function(t){t.commentAdmin.length>0&&(e=!0)})),e&&this.isAdmin)}}),mounted:function(){setTimeout(this.initSelector,100)},methods:{initSelector:function(){var e=this;this.rating.forEach((function(t){e.getSelector(t.signature,t.depend)}))},getSelector:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];BX.ajax({url:templateFolder+"/select.php",data:{id:e,depend:t},dataType:"html",method:"POST",timeout:30,async:!1,processData:!0,scriptsRunFirst:!1,cache:!1,onsuccess:function(t){BX(e).innerHTML=t},onfailure:function(e){console.log(e)}})},loadFile:function(e,t){var s=this,a=new FormData;if(e.target.files&&e.target.files[0]){var n=e.target.files[0];a.append("file",n,n.name),BX.ajax.runComponentAction("ithive.goalsbazhen:edit.card.rating","saveFile",{mode:"class",dataType:"json",data:a}).then((function(e){s.rating[t]["file_rating"]={id:e.data.id,name:n.name,path:e.data.path}})).catch((function(e){console.log(e)}))}},deleteFile:function(e){var t=this;BX.ajax.runComponentAction("ithive.goalsbazhen:edit.card.rating","deleteFile",{mode:"class",dataType:"json",data:{id:this.rating[e]["file_rating"]}}).then((function(){t.rating[e]["file_rating"]=""})).catch((function(e){console.log(e)}))},changePercentInputType:function(e){event.preventDefault();var t=event.target.parentElement.previousSibling,s=event.target.parentElement.nextSibling;"input"===event.target.dataset.activeMode?(s.style.visibility="hidden",t.style.visibility="visible",event.target.dataset.activeMode="select"):(s.style.visibility="visible",t.style.visibility="hidden",event.target.dataset.activeMode="input"),this.rating[e].progress=0},saveRating:function(){event.preventDefault();var e=window.top.BX.SidePanel.Instance.getTopSlider();e.showLoader(),window.top.BX.ajax.runComponentAction("ithive.goalsbazhen:edit.card.goals","saveGoals",{mode:"class",data:{params:{cardId:this.cardId,goals:this.goals}}}).then((function(){e.reload();var t=window.top.BX.Main.gridManager.data[0].id;window.top.BX.Main.gridManager.getById(t).instance.reloadTable("POST",{apply_filter:"Y",clear_nav:"Y"})})).catch((function(){e.closeLoader()}))}},watch:{totalProgress:function(){parseFloat(this.totalProgress)>parseFloat(this.totalProgressOld)?this.$store.commit("setProgressValue",parseFloat(this.totalProgress)):this.$store.commit("setProgressValue",parseFloat(this.totalProgressOld))},totalProgressOld:function(){parseFloat(this.totalProgress)>parseFloat(this.totalProgressOld)?this.$store.commit("setProgressValue",parseFloat(this.totalProgress)):this.$store.commit("setProgressValue",parseFloat(this.totalProgressOld))}}}),D=x,X=Object(u["a"])(D,k,B,!1,null,null,null),G=X.exports,z=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"block-process",staticStyle:{"margin-bottom":"80px"}},[e.prevRating.length>0?[s("div",{staticClass:"title-block-process"},[e._v(e._s(e.localize.INFO_RATING))]),s("table",{staticClass:"history-table"},e._l(e.prevRating,(function(t,a){return s("tr",{key:"prev_rating_"+a},[s("td",{staticClass:"history-column"},[e._v(e._s(e.localize.REPORT_RATING)+" "+e._s(a+1))]),s("td",{staticClass:"history-column"},[e._v(e._s(t))])])})),0)]:e._e()],2)},H=[],j={name:"History",computed:Object(i["a"])(Object(i["a"])({},Object(c["b"])(["prevRating"])),{},{localize:function(){return Object.freeze({INFO_RATING:BX.message("INFO_RATING"),REPORT_RATING:BX.message("REPORT_RATING")})}})},L=j,F=Object(u["a"])(L,z,H,!1,null,null,null),V=F.exports,Y=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("table",{staticClass:"log-table"},[s("tr",[s("td",{staticClass:"log-table-head"},[e._v(e._s(e.localize.DATA))]),s("td",{staticClass:"log-table-head"},[e._v(e._s(e.localize.AUTHOR))]),s("td",{staticClass:"log-table-head"},[e._v(e._s(e.localize.TYPE))]),s("td",{staticClass:"log-table-head"},[e._v(e._s(e.localize.DESCRIPTION))]),s("td",{staticClass:"log-table-head"},[e._v(e._s(e.localize.COMMENT))])]),e._l(e.logs,(function(t,a){return s("tr",{key:"log_"+a},[s("td",{staticClass:"log-table-column"},[e._v(e._s(t.MODIFIED))]),s("td",{staticClass:"log-table-column"},[e._v(e._s(t.MODIFIED_BY))]),s("td",{staticClass:"log-table-column"},[e._v(e._s(t.ACTION_NAME))]),s("td",{staticClass:"log-table-column"},[e._v(e._s(t.ACTION_TITLE))]),s("td",{staticClass:"log-table-column"},[e._v(e._s(t.ACTION_NOTE))])])}))],2)},U=[],$={name:"Logs",computed:Object(i["a"])(Object(i["a"])({},Object(c["b"])(["logs"])),{},{localize:function(){return Object.freeze({DATA:BX.message("DATA"),AUTHOR:BX.message("AUTHOR"),TYPE:BX.message("TYPE"),DESCRIPTION:BX.message("DESCRIPTION"),COMMENT:BX.message("COMMENT")})}})},W=$,J=Object(u["a"])(W,Y,U,!1,null,null,null),q=J.exports,K={name:"App",components:{History:V,HeadTitle:g,HeadStages:h,HeadInfo:N,RatingTable:G,Logs:q},data:function(){return{comment:"",stageToChange:"",activeTab:"goals"}},computed:Object(i["a"])(Object(i["a"])({},Object(c["b"])(["cardId","rating","canEdit","statusGoals","isDraftStage","isCompleteStage","activeStage","isDraftStage","isAgreementHead","isAgreementAdmin","maxPercent","isAdmin"])),{},{localize:function(){return Object.freeze({RATING:BX.message("RATING"),HISTORY:BX.message("HISTORY"),SEND_AGREE:BX.message("SEND_AGREE"),DECLINE:BX.message("DECLINE"),APPROVE:BX.message("APPROVE"),NOT_APPROVE:BX.message("NOT_APPROVE"),AGREE:BX.message("AGREE"),NOT_AGREE:BX.message("NOT_AGREE"),COMMENT:BX.message("COMMENT"),SEND:BX.message("SEND"),SELECT_STAGE:BX.message("SELECT_STAGE")})},activeSort:function(){for(var e=Object.values(this.statusGoals),t=0;t<e.length;t++)if(e[t].id===this.activeStage)return e[t].sort},canSubmit:function(){var e=this,t=!0;return this.rating.forEach((function(s){(!s.progress||e.isDraftStage&&0===s.commentEmployee.length||s.progress<0||s.progress>e.maxPercent||s.progress<s.progressPrev)&&(t=!1)})),t},progressChange:function(){var e=this,t=!1;return this.rating.forEach((function(s){(parseInt(s.progress)!==parseInt(s.progressBeforeUpdate)&&(e.isAgreementHead&&0===s.commentHead.length||e.isAgreementDirector&&0===s.commentDirector.length)||s.progress<0||s.progress>e.maxPercent)&&(t=!0)})),t}}),methods:{sendAgreement:function(){var e=window.BX.SidePanel.Instance.getTopSlider();e.showLoader(),window.top.BX.ajax.runComponentAction("ithive.goalsbazhen:edit.card.rating","nextStatus",{mode:"class",data:{params:{cardId:this.cardId,rating:this.rating,activeStage:this.activeStage}}}).then((function(){window.top.BX.SidePanel.Instance.close();var e=window.top.BX.Main.gridManager.data[0].id;window.top.BX.Main.gridManager.getById(e).instance.reloadTable("POST",{apply_filter:"Y",clear_nav:"Y"})})).catch((function(){e.closeLoader();var t=window.top.BX.Main.gridManager.data[0].id;window.top.BX.Main.gridManager.getById(t).instance.reloadTable("POST",{apply_filter:"Y",clear_nav:"Y"})}))},openModalComment:function(){var e=new window.BX.PopupWindow("call-decline",window.body,{closeIcon:{right:"20px",top:"10px"},titleBar:{content:window.BX.create("span",{html:BX.message("SET_COMMENT"),props:{className:"call-decline-title"}})},autoHide:!0,zIndex:5e3,offsetTop:1,offsetLeft:0,lightShadow:!0,closeByEsc:!0,overlay:{backgroundColor:"grey",opacity:"80"}});e.setContent(window.BX("commentPopup")),e.show()},closeSlider:function(){window.top.BX.SidePanel.Instance.close()},sendDecline:function(){var e=window.BX.SidePanel.Instance.getTopSlider();e.showLoader(),window.top.BX.ajax.runComponentAction("ithive.goalsbazhen:edit.card.rating","prevStatus",{mode:"class",data:{params:{cardId:this.cardId,rating:this.rating,activeStage:this.activeStage,stageToChange:this.stageToChange,comment:this.comment}}}).then((function(){window.top.BX.SidePanel.Instance.close();var e=window.top.BX.Main.gridManager.data[0].id;window.top.BX.Main.gridManager.getById(e).instance.reloadTable("POST",{apply_filter:"Y",clear_nav:"Y"})})).catch((function(){e.closeLoader(),window.top.BX.SidePanel.Instance.close();var t=window.top.BX.Main.gridManager.data[0].id;window.top.BX.Main.gridManager.getById(t).instance.reloadTable("POST",{apply_filter:"Y",clear_nav:"Y"})}))}}},Q=K,Z=Object(u["a"])(Q,n,o,!1,null,null,null),ee=Z.exports;s("25f0");a["a"].use(c["a"]);var te=window.jsParams,se=[];te.ITEM.RATING.length&&te.ITEM.RATING.forEach((function(e){e.signature=Math.random().toString(36).substring(7),se.push(e)}));var ae=new c["a"].Store({state:{rating:se,prevRating:te.ITEM.PREV_RATING,processInfo:te.ITEM.PROCESS_INFO,userInfo:te.ITEM.USER_INFO,statusGoals:te.ITEM.STATUS_GOALS,activeStage:te.ITEM.ACTIVE_STAGE,cardId:te.ITEM.ID,isDraftStage:te.ITEM.IS_DRAFT_STAGE,isAgreementHead:te.ITEM.IS_AGREEMENT_HEAD,isAgreementFuncHead:te.ITEM.IS_AGREEMENT_FUNC_HEAD,isAgreementDirector:te.ITEM.IS_AGREEMENT_DIRECTOR,isAgreementAdmin:te.ITEM.IS_AGREEMENT_ADMIN,isCompleteStage:te.ITEM.IS_COMPLETE_STAGE,logs:te.ITEM.LOGS,canEdit:te.ITEM.CAN_EDIT,isAdmin:te.ITEM.IS_ADMIN,progressValue:parseFloat(te.ITEM.PROGRESS_VALUE),progressTime:parseFloat(te.ITEM.PROGRESS_TIME),maxPercent:parseInt(te.ITEM.MAX_PERCENT),isLast:te.ITEM.IS_LAST,canSelectPercentOptions:te.ITEM.ADDITIONAL_PARAMETERS.CAN_SELECT_PERCENT_OPTION,percentSelectOptions:te.ITEM.ADDITIONAL_PARAMETERS.PERCENT_SELECT_OPTIONS},mutations:{setProgressValue:function(e,t){e.progressValue=t}}});a["a"].config.productionTip=!1,new a["a"]({render:function(e){return e(ee)},store:ae}).$mount("#edit_rating")}});