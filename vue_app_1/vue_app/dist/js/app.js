(function(e){function t(t){for(var a,i,c=t[0],l=t[1],r=t[2],p=0,u=[];p<c.length;p++)i=c[p],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&u.push(o[i][0]),o[i]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);d&&d(t);while(u.length)u.shift()();return n.push.apply(n,r||[]),s()}function s(){for(var e,t=0;t<n.length;t++){for(var s=n[t],a=!0,c=1;c<s.length;c++){var l=s[c];0!==o[l]&&(a=!1)}a&&(n.splice(t--,1),e=i(i.s=s[0]))}return e}var a={},o={app:0},n=[];function i(t){if(a[t])return a[t].exports;var s=a[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=a,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(s,a,function(t){return e[t]}.bind(null,a));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/bitrix/components/ithive.goalsbazhen/edit.card.goals/templates/.default/vue_app/dist/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],l=c.push.bind(c);c.push=t,c=c.slice();for(var r=0;r<c.length;r++)t(c[r]);var d=l;n.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"56d7":function(e,t,s){"use strict";s.r(t);s("e260"),s("e6cf"),s("cca6"),s("a79d");var a=s("2b0e"),o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("form",{staticClass:"slider-form",attrs:{method:"post",name:"sliderForm"}},[s("input",{staticClass:"slider-field",attrs:{type:"hidden",value:"",name:"ID"}}),s("head-title"),s("head-stages"),s("div",{staticClass:"form-tabs"},[s("span",{staticClass:"form-tabs-span",class:{"form-tabs-span-active":"goals"===e.activeTab},on:{click:function(t){e.activeTab="goals"}}},[e._v(e._s(e.localize.GOALS))]),s("span",{staticClass:"form-tabs-span",class:{"form-tabs-span-active":"history"===e.activeTab},on:{click:function(t){e.activeTab="history"}}},[e._v(e._s(e.localize.HISTORY))])]),"goals"===e.activeTab?s("div",{staticClass:"form-container"},[s("head-info"),s("goals-table")],1):e._e(),"history"===e.activeTab?s("div",{staticClass:"form-container"},[s("logs")],1):e._e(),e.canEdit?[e.isDraftStage?s("div",{staticClass:"button-line"},[s("button",{staticClass:"btn-submit",class:{"btn-submit-cancel":e.disableBtn},attrs:{type:"button",disabled:e.disableBtn},on:{click:function(t){return e.sendAgreement()}}},[e._v(e._s(e.localize.SEND_AGREE)+" ")]),s("button",{staticClass:"btn-cancel",attrs:{type:"button"},on:{click:function(t){return e.closeSlider()}}},[e._v(e._s(e.localize.DECLINE))])]):e.isApprovalStage?s("div",{staticClass:"button-line"},[s("button",{staticClass:"btn-submit",class:{"btn-submit-cancel":e.disableBtn},attrs:{type:"button",disabled:e.disableBtn},on:{click:function(t){return e.sendAgreement()}}},[e._v(e._s(e.localize.APPROVE)+" ")]),s("button",{staticClass:"btn-return",attrs:{type:"button"},on:{click:function(t){return e.openModalComment()}}},[e._v(e._s(e.localize.NOT_APPROVE))]),s("button",{staticClass:"btn-cancel",attrs:{type:"button"},on:{click:function(t){return e.closeSlider()}}},[e._v(e._s(e.localize.DECLINE))])]):s("div",{staticClass:"button-line"},[s("button",{staticClass:"btn-submit",class:{"btn-submit-cancel":e.disableBtn},attrs:{type:"button",disabled:e.disableBtn},on:{click:function(t){return e.sendAgreement()}}},[e._v(e._s(e.localize.AGREE)+" ")]),s("button",{staticClass:"btn-return",attrs:{type:"button"},on:{click:function(t){return e.openModalComment()}}},[e._v(e._s(e.localize.NOT_AGREE))]),s("button",{staticClass:"btn-cancel",attrs:{type:"button"},on:{click:function(t){return e.closeSlider()}}},[e._v(e._s(e.localize.DECLINE))])]),s("div",{staticStyle:{display:"none"},attrs:{id:"commentPopup"}},[e.isAdmin?s("select",{directives:[{name:"model",rawName:"v-model",value:e.stageToChange,expression:"stageToChange"}],staticClass:"block-process-table-select",staticStyle:{"margin-bottom":"15px"},on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.stageToChange=t.target.multiple?s:s[0]}}},[s("option",{attrs:{value:"",selected:"",disabled:""}},[e._v(e._s(e.localize.SELECT_STAGE))]),e._l(e.statusGoals,(function(t){return t.sort<e.activeSort?s("option",{domProps:{value:t.id}},[e._v(e._s(t.value)+" ")]):e._e()}))],2):e._e(),s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.comment,expression:"comment"}],staticClass:"comment-area",attrs:{rows:"5",placeholder:e.localize.COMMENT},domProps:{value:e.comment},on:{input:function(t){t.target.composing||(e.comment=t.target.value)}}}),s("button",{staticClass:"btn-submit",attrs:{type:"button"},on:{click:function(t){return e.sendDecline()}}},[e._v(e._s(e.localize.SEND))])])]:e._e()],2)])},n=[],i=s("5530"),c=(s("dca8"),s("07ac"),s("4e82"),s("d3b7"),s("159b"),s("a9e3"),s("99af"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"form-title"},[s("span",{staticClass:"form-title-label"},[e._v(e._s(e.localize.GOALS_EMPLOYEE)+" "+e._s(e.userInfo.NAME))])])}),l=[],r=s("2f62"),d={name:"HeadTitle",props:{title:String},computed:Object(i["a"])(Object(i["a"])({},Object(r["b"])(["userInfo"])),{},{localize:function(){return Object.freeze({GOALS_EMPLOYEE:BX.message("GOALS_EMPLOYEE")})}})},p=d,u=s("2877"),g=Object(u["a"])(p,c,l,!1,null,null,null),E=g.exports,_=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"crm-entity-section-status-container-flex"},e._l(e.statusGoals,(function(t,a){return s("div",{key:"status_goal_"+a,staticClass:"crm-entity-section-status-step"},[s("div",{staticClass:"crm-entity-section-status-step-item"},[s("div",{staticClass:"crm-entity-section-status-step-item-text",style:{borderImage:t.background,color:t.color},attrs:{"data-base-color":"#00C4FB"}},[e._v(" "+e._s(t.value)+" ")])])])})),0)},h=[],b={name:"HeadStages",computed:Object(i["a"])({},Object(r["b"])(["statusGoals"]))},v=b,m=Object(u["a"])(v,_,h,!1,null,null,null),f=m.exports,S=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"block-process"},[s("div",{staticClass:"title-block-process"},[e._v(e._s(e.localize.ABOUT_PROCESS))]),s("div",{staticClass:"block-process-info"},[s("div",{staticClass:"sub-block-info-user"},[s("span",{staticClass:"sub-block-info-title"},[e._v(e._s(e.localize.ASSESSED))]),s("div",{staticClass:"sub-block-info-employee"},[e.userInfo.ICON?s("div",{staticClass:"sub-block-info-inline"},[s("img",{staticClass:"sub-block-info-icon",attrs:{src:e.userInfo.ICON}})]):e._e(),s("div",{staticClass:"sub-block-info-inline"},[s("span",{staticClass:"sub-block-info-name"},[s("a",{attrs:{href:"/company/personal/user/"+e.userInfo.ID+"/"}},[e._v(e._s(e.userInfo.NAME))])]),s("span",{staticClass:"sub-block-info-position"},[e._v(e._s(e.userInfo.POSITION))]),s("span",{staticClass:"sub-block-info-department"},[e._v(e._s(e.userInfo.DEPARTMENT))])])])]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.delegateInfo.ID>0,expression:"delegateInfo.ID>0"}],staticClass:"sub-block-info-user"},[s("span",{staticClass:"sub-block-info-title"},[e._v(e._s(e.localize.DELEGATE))]),s("div",{staticClass:"sub-block-info-employee"},[e.delegateInfo.ICON?s("div",{staticClass:"sub-block-info-inline"},[s("img",{staticClass:"sub-block-info-icon",attrs:{src:e.delegateInfo.ICON}})]):e._e(),s("div",{staticClass:"sub-block-info-inline"},[s("span",{staticClass:"sub-block-info-name"},[s("a",{attrs:{href:"/company/personal/user/"+e.delegateInfo.ID+"/"}},[e._v(e._s(e.delegateInfo.NAME))])]),s("span",{staticClass:"sub-block-info-position"},[e._v(e._s(e.delegateInfo.POSITION))]),s("span",{staticClass:"sub-block-info-department"},[e._v(e._s(e.delegateInfo.DEPARTMENT))])]),e.canEditDelegate?s("div",{staticClass:"delete-delegate",on:{click:function(t){return e.deleteDelegate()}}}):e._e()])]),e.canEditDelegate?s("div",{directives:[{name:"show",rawName:"v-show",value:e.delegateInfo.ID<=0,expression:"delegateInfo.ID<=0"}],staticClass:"sub-block-info-user"},[s("span",{staticClass:"sub-block-info-title"},[e._v(e._s(e.localize.DELEGATE))]),e._m(0)]):e._e(),s("div",{staticClass:"sub-block-info"},e._l(e.processInfo,(function(e,t){return s("disable-input",{key:"process_info_"+t,attrs:{title:e.title,value:e.value}})})),1)])])},C=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"sub-block-info-employee"},[s("div",{staticClass:"sub-block-info-inline"},[s("img",{staticClass:"sub-block-info-icon"})]),s("div",{staticClass:"sub-block-info-inline"},[s("span",{staticClass:"sub-block-info-name",staticStyle:{"line-height":"34px"}},[s("div",{attrs:{id:"choice-delegate"}})])])])}],T=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"sub-block-info-element"},[s("span",{staticClass:"sub-block-info-title"},[e._v(e._s(e.title))]),s("input",{staticClass:"sub-block-info-value",attrs:{disabled:"disabled"},domProps:{value:e.value}})])},A=[],O={name:"DisableInput",props:{title:String,value:String}},I=O,w=Object(u["a"])(I,T,A,!1,null,null,null),y=w.exports,B={name:"HeadInfo",components:{DisableInput:y},computed:Object(i["a"])(Object(i["a"])({},Object(r["b"])(["processInfo","userInfo","delegateInfo","cardId","selectorId","canEditDelegate"])),{},{localize:function(){return Object.freeze({ABOUT_PROCESS:BX.message("ABOUT_PROCESS"),ASSESSED:BX.message("ASSESSED"),DELEGATE:BX.message("DELEGATE"),DELETE_DELEGATE_POPUP_TITLE:BX.message("DELETE_DELEGATE_POPUP_TITLE"),DELETE_DELEGATE_POPUP_CONTENT:BX.message("DELETE_DELEGATE_POPUP_CONTENT"),DELETE_DELEGATE_POPUP_YES:BX.message("DELETE_DELEGATE_POPUP_YES"),DELETE_DELEGATE_POPUP_CANCEL:BX.message("DELETE_DELEGATE_POPUP_CANCEL"),SET_DELEGATE_POPUP_TITLE:BX.message("SET_DELEGATE_POPUP_TITLE"),SET_DELEGATE_POPUP_CONTENT:BX.message("SET_DELEGATE_POPUP_CONTENT"),SET_DELEGATE_POPUP_YES:BX.message("SET_DELEGATE_POPUP_YES"),SET_DELEGATE_POPUP_CANCEL:BX.message("SET_DELEGATE_POPUP_CANCEL")})}}),mounted:function(){setTimeout(this.initSelector,100)},methods:{initSelector:function(){var e=this;this.getSelector(),BX.addCustomEvent("BX.Main.User.SelectorController:select",(function(t){if(t.selectorId===e.selectorId){var s=BX("bx-selector-dialog-"+e.selectorId);if(s){var a=s.querySelector(".popup-window-close-icon");a&&a.click()}e.setDelegate(e.cardId,t.item.entityId)}}))},deleteDelegate:function(){var e=this;new BX.PopupWindow("delete-delegate-popup",window.body,{autoHide:!0,offsetTop:1,offsetLeft:0,lightShadow:!0,closeIcon:!0,closeByEsc:!0,overlay:{backgroundColor:"white",opacity:"80"},titleBar:{content:BX.create("p",{html:e.localize.DELETE_DELEGATE_POPUP_TITLE})},content:e.localize.DELETE_DELEGATE_POPUP_CONTENT,buttons:[new BX.PopupWindowButton({text:e.localize.DELETE_DELEGATE_POPUP_YES,className:"ui-btn ui-btn-primary",events:{click:function(){this.popupWindow.destroy(),this.popupWindow.close(),BX.ajax.runComponentAction("ithive.goalsbazhen:edit.card.goals","deleteDelegate",{mode:"class",data:{params:{cardId:e.cardId,userId:e.delegateInfo.ID}}}).then((function(t){e.reloadCard()})).catch((function(e){console.log(e)}))}}}),new BX.PopupWindowButton({text:e.localize.DELETE_DELEGATE_POPUP_CANCEL,className:"ui-btn ui-btn-light",events:{click:function(){this.popupWindow.destroy(),this.popupWindow.close()}}})]}).show()},setDelegate:function(e,t){var s=this;new BX.PopupWindow("set-delegate-popup",window.body,{autoHide:!0,offsetTop:1,offsetLeft:0,lightShadow:!0,closeIcon:!0,closeByEsc:!0,overlay:{backgroundColor:"white",opacity:"80"},titleBar:{content:BX.create("p",{html:s.localize.SET_DELEGATE_POPUP_TITLE})},content:s.localize.SET_DELEGATE_POPUP_CONTENT,buttons:[new BX.PopupWindowButton({text:s.localize.SET_DELEGATE_POPUP_YES,className:"ui-btn ui-btn-primary",events:{click:function(){this.popupWindow.destroy(),this.popupWindow.close(),BX.ajax.runComponentAction("ithive.goalsbazhen:edit.card.goals","setDelegate",{mode:"class",data:{params:{cardId:e,userId:t}}}).then((function(e){s.reloadCard()})).catch((function(e){console.log(e)}))}}}),new BX.PopupWindowButton({text:s.localize.SET_DELEGATE_POPUP_CANCEL,className:"ui-btn ui-btn-light ",events:{click:function(){this.popupWindow.destroy(),this.popupWindow.close()}}})]}).show()},getSelector:function(){var e=this;BX.ajax({url:templateFolder+"/select.php",data:{id:e.selectorId,depend:[],isDep:!1},dataType:"html",method:"POST",timeout:30,async:!1,processData:!0,scriptsRunFirst:!1,cache:!1,onsuccess:function(t){BX(e.selectorId).innerHTML=t},onfailure:function(e){console.log(e)}})},reloadCard:function(){var e=window.top.BX.Main.gridManager.data[0].id;window.top.BX.SidePanel.Instance.reload(),window.top.BX.Main.gridManager.getById(e).instance.reloadTable("POST",{apply_filter:"Y",clear_nav:"Y"})}}},L=B,P=Object(u["a"])(L,S,C,!1,null,null,null),k=P.exports,D=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"block-process",staticStyle:{"margin-top":"10px","margin-bottom":"80px"}},[s("div",{staticClass:"block-process-info"},[s("table",{staticClass:"block-process-table"},[s("tr",[s("td",{staticClass:"block-process-table-head",staticStyle:{width:"10%"}},[e._v(e._s(e.localize.TYPE_GOALS))]),s("td",{staticClass:"block-process-table-head",staticStyle:{width:"20%"}},[e._v(e._s(e.localize.GOAL))]),s("td",{staticClass:"block-process-table-head",staticStyle:{width:"20%"}},[e._v(e._s(e.localize.CRITERION))]),s("td",{staticClass:"block-process-table-head",staticStyle:{width:"10%"}},[e._v(e._s(e.localize.WEIGHT))]),s("td",{staticClass:"block-process-table-head",staticStyle:{width:"10%"}},[e._v(e._s(e.localize.GOAL_FILE))]),s("td",{staticClass:"block-process-table-head",staticStyle:{width:"20%"}},[e._v(e._s(e.localize.CASCADE))]),s("td",{staticClass:"block-process-table-head",staticStyle:{width:"20%"}},[e._v(e._s(e.localize.DEPENDS_ON))]),s("td",{staticClass:"block-process-table-head",staticStyle:{width:"30%","min-width":"200px"}},[e._v(e._s(e.localize.LINK_TASK_PROJECT)+" ")]),e.canEdit?s("td",{staticClass:"block-process-table-head",staticStyle:{width:"10%"}},[e._v(e._s(e.localize.DELETE))]):e._e()]),e._l(e.goals,(function(t,a){return s("tr",{key:"goal_"+a},[s("td",{staticClass:"block-process-table-column"},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.type_goal,expression:"goal.type_goal"}],staticClass:"block-process-table-select",class:{"block-process-criterion-value-error":0===t.type_goal.length},attrs:{disabled:"Y"===t.disableFields},on:{change:[function(s){var a=Array.prototype.filter.call(s.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(t,"type_goal",s.target.multiple?a:a[0])},function(t){return e.clearGoalTask(a)}]}},[s("option",{attrs:{value:"",selected:"",disabled:""}},[e._v(e._s(e.localize.SELECT_TYPE_GOAL))]),e._l(e.typeGoals,(function(t,a){return s("option",{key:"type_goal_"+a,domProps:{value:t.id}},[e._v(" "+e._s(t.value)+" ")])}))],2)]),s("td",{staticClass:"block-process-table-column"},[t.type_goal&&"smart"===e.typeGoals[t.type_goal]["xml_id"]?s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.task,expression:"goal.task"}],staticClass:"block-process-table-textarea",class:{"block-process-criterion-value-error":0===t.task.length},domProps:{value:t.task},on:{input:function(s){s.target.composing||e.$set(t,"task",s.target.value)}}}):s("select",{directives:[{name:"model",rawName:"v-model",value:t.goal,expression:"goal.goal"}],staticClass:"block-process-table-select",class:{"block-process-criterion-value-error":0===t.goal.length},attrs:{disabled:"Y"===t.disableFields},on:{change:[function(s){var a=Array.prototype.filter.call(s.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(t,"goal",s.target.multiple?a:a[0])},function(t){return e.checkGoalWeight(t,a)}]}},[s("option",{attrs:{value:"",selected:"",disabled:""}},[e._v(e._s(e.localize.SELECT_GOAL))]),e._l(e.listGoals[t.type_goal],(function(t,a){return s("option",{key:"goal_user_"+a,domProps:{value:a}},[e._v(e._s(t.NAME)+" ")])}))],2)]),s("td",{staticClass:"block-process-table-column"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.criterion,expression:"goal.criterion"}],staticClass:"block-process-table-textarea",class:{"block-process-criterion-value-error":0===t.criterion.length},attrs:{disabled:"Y"===t.disableFields},domProps:{value:t.criterion},on:{input:function(s){s.target.composing||e.$set(t,"criterion",s.target.value)}}})]),s("td",{staticClass:"block-process-table-column"},[t.weight<e.minWeight||t.weight>100?s("span",{staticStyle:{"font-size":"11px",color:"red"}},[e._v(e._s(e.localize.VALUE_FROM)+e._s(e.minWeight)+e._s(e.localize.VALUE_TO))]):e._e(),s("input",{directives:[{name:"model",rawName:"v-model",value:t.weight,expression:"goal.weight"}],staticClass:"block-process-table-input",class:{"block-process-weight-value-error":t.weight<e.minWeight||t.weight>100},attrs:{type:"number",min:t.categoryWeight,disabled:!0===t.disabled_input_number},domProps:{value:t.weight},on:{input:[function(s){s.target.composing||e.$set(t,"weight",s.target.value)},function(t){return e.checkMinGoalWeight(t,a)}]}})]),s("td",{staticClass:"block-process-table-column"},[t.file?s("div",[s("a",{staticClass:"block-process-file-img",attrs:{title:t.file.name,href:t.file.path,target:"_blank"}}),"N"===t.disableFields?s("span",{key:"goal_file_delete_"+a,staticClass:"block-process-file-delete",on:{click:function(t){return e.deleteFile(a)}}},[e._v("x")]):e._e()]):s("div",[s("label",{staticClass:"block-process-file-text",attrs:{for:"goal_file_"+a}},[e._v(e._s(e.localize.ATTACH))]),s("input",{key:"goal_file_"+a,staticStyle:{display:"none"},attrs:{id:"goal_file_"+a,type:"file"},on:{change:function(t){return e.loadFile(t,a)}}})])]),s("td",{staticClass:"block-process-table-column"},["Y"===t.canCascade?s("div",[s("div",{staticClass:"block-process-users-block",style:["Y"===e.userInfo.HAVE_SUBORDINATE_BOSSES&&"Y"===e.userInfo.HAVE_SUBORDINATE_EMPLOYEES&&"Y"===e.userInfo.IS_BOSS?{top:"30px"}:{top:"0px"}]},[s("div",{staticClass:"faces-base"},[e.userInfo.ID!==t.cascadeSource&&"0"!==t.cascadeSource&&null!==t.cascadeSource?s("div",[s("a",{staticClass:"bp-short-process-step bp-short-process-step-firs",attrs:{href:"/company/personal/user/"+t.cascadeSource+"/"}},[s("div",{staticClass:"bp-short-process-step-inner ui-icon ui-icon-common-user"},[e.usersAvatars[t.cascadeSource]?s("i",{style:{backgroundImage:"url("+e.usersAvatars[t.cascadeSource]+")"}}):s("i")])]),s("span",{staticClass:"bp-short-prosess-steps-arrow bp-short-prosess-steps-arrow-running"}),s("a",{staticClass:"bp-short-process-step bp-short-process-step-ready",attrs:{href:"/company/personal/user/"+e.userInfo.ID+"/"}},[s("div",{staticClass:"bp-short-process-step-inner ui-icon ui-icon-common-user"},[e.usersAvatars[e.userInfo.ID]?s("i",{style:{backgroundImage:"url("+e.usersAvatars[e.userInfo.ID]+")"}}):s("i")])])]):e._e(),e.userInfo.ID!==t.cascadeSource||"Y"!==e.userInfo.IS_BOSS||"Y"!==e.userInfo.HAVE_SUBORDINATE_BOSSES&&"Y"!==e.userInfo.HAVE_SUBORDINATE_EMPLOYEES?e._e():s("div",[s("a",{staticClass:"bp-short-process-step bp-short-process-step-ready",attrs:{href:"/company/personal/user/"+t.cascadeSource+"/"}},[s("div",{staticClass:"bp-short-process-step-inner ui-icon ui-icon-common-user"},[e.usersAvatars[t.cascadeSource]?s("i",{style:{backgroundImage:"url("+e.usersAvatars[t.cascadeSource]+")"}}):s("i")])])]),"0"!==t.cascadeSource&&null!==t.cascadeSource||"Y"!==e.userInfo.IS_BOSS||"Y"!==e.userInfo.HAVE_SUBORDINATE_BOSSES&&"Y"!==e.userInfo.HAVE_SUBORDINATE_EMPLOYEES?e._e():s("div",[s("a",{staticClass:"bp-short-process-step bp-short-process-step-ready",attrs:{href:"/company/personal/user/"+e.userInfo.ID+"/"}},[s("div",{staticClass:"bp-short-process-step-inner ui-icon ui-icon-common-user"},[e.usersAvatars[e.userInfo.ID]?s("i",{style:{backgroundImage:"url("+e.usersAvatars[e.userInfo.ID]+")"}}):s("i")])])]),e.userInfo.IS_BOSS&&"Y"===e.userInfo.HAVE_SUBORDINATE_BOSSES&&"Y"===e.userInfo.HAVE_SUBORDINATE_EMPLOYEES?s("div",[s("div",{staticClass:"multiple-choice-faces",staticStyle:{bottom:"30px"}},[t.cascadeOnBosses.length>0?s("div",[s("div",[s("span",{staticClass:"bp-short-prosess-steps-arrow bp-short-prosess-steps-arrow-running"}),s("a",{staticClass:"bp-short-process-step bp-short-process-step-more"},[s("div",{staticClass:"bp-short-process-step-inner ui-icon ui-icon-common-user"},[e.usersAvatars[Object.values(e.userSubordinateBosses)[0]]?s("i",{style:{backgroundImage:"url("+e.usersAvatars[Object.values(e.userSubordinateBosses)[0]]+")"}}):s("i")])]),s("span",{staticClass:"process-step-more"},[s("span",{staticStyle:{cursor:"pointer"},on:{click:function(s){return e.getParticipationUsersInfo(t,"bosses")}}},[e._v(e._s(t.cascadeOnBosses.length)+" "+e._s(e.localize.SUB_BOSSES))]),s("span",{staticStyle:{cursor:"pointer",margin:"0 0 0 5px","vertical-align":"middle"},on:{click:function(s){return e.cleanCascadeUsers(t,"bosses")}}},[s("svg",{attrs:{width:"8",height:"9",viewBox:"0 0 8 9",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[s("path",{attrs:{d:"M4.94151 4.50001L7.53917 1.90235C7.66246 1.77929 7.7318 1.61229 7.73196 1.43809C7.73211 1.26389 7.66306 1.09677 7.53999 0.973486C7.41692 0.850202 7.24992 0.780855 7.07573 0.780701C6.90153 0.780547 6.73441 0.849599 6.61112 0.972666L4.01347 3.57032L1.41581 0.972666C1.29253 0.849381 1.12532 0.780121 0.950968 0.780121C0.776617 0.780121 0.609408 0.849381 0.486124 0.972666C0.36284 1.09595 0.293579 1.26316 0.293579 1.43751C0.293579 1.61186 0.36284 1.77907 0.486124 1.90235L3.08378 4.50001L0.486124 7.09767C0.36284 7.22095 0.293579 7.38816 0.293579 7.56251C0.293579 7.73686 0.36284 7.90407 0.486124 8.02735C0.609408 8.15064 0.776617 8.2199 0.950968 8.2199C1.12532 8.2199 1.29253 8.15064 1.41581 8.02735L4.01347 5.4297L6.61112 8.02735C6.73441 8.15064 6.90162 8.2199 7.07597 8.2199C7.25032 8.2199 7.41753 8.15064 7.54081 8.02735C7.6641 7.90407 7.73336 7.73686 7.73336 7.56251C7.73336 7.38816 7.6641 7.22095 7.54081 7.09767L4.94151 4.50001Z",fill:"#D9D9D9"}})])])])])]):e._e(),0===t.cascadeOnBosses.length?s("div",{staticStyle:{"margin-top":"15px"}},[s("span",{staticClass:"bp-short-prosess-steps-arrow bp-short-prosess-steps-arrow-running"}),s("div",{staticClass:"add-faces",on:{click:function(s){return e.checkAccessTo("bosses",t)}}},[s("svg",{attrs:{width:"34",height:"34",viewBox:"0 0 34 34",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[s("rect",{attrs:{x:"0.793579",y:"0.5",width:"31",height:"31",rx:"15.5",stroke:"#A5ADB3"}}),s("svg",{attrs:{width:"30",height:"30",viewBox:"-8 -8 30 30",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[s("path",{attrs:{d:"M8.00012 15V8M8.00012 8V1M8.00012 8H15.0001M8.00012 8H1.00012",stroke:"#A5ADB3","stroke-linecap":"round"}})])]),s("span",{staticClass:"process-step-more",staticStyle:{position:"relative",bottom:"15px"}},[s("span",{staticStyle:{cursor:"pointer",color:"#535C69"}},[e._v(e._s(e.localize.SUB_BOSSES))]),s("span",{staticStyle:{cursor:"pointer",margin:"0 0 0 5px","vertical-align":"middle"}})])])]):e._e(),t.cascadeOnEmployees.length>0?s("div",[s("div",[s("span",{staticClass:"bp-short-prosess-steps-arrow bp-short-prosess-steps-arrow-running"}),s("a",{staticClass:"bp-short-process-step bp-short-process-step-more"},[s("div",{staticClass:"bp-short-process-step-inner ui-icon ui-icon-common-user"},[e.usersAvatars[Object.values(t.cascadeOnEmployees)[0]]?s("i",{style:{backgroundImage:"url("+e.usersAvatars[Object.values(t.cascadeOnEmployees)[0]]+")"}}):s("i")]),s("span",{staticClass:"process-step-more",staticStyle:{left:"40px",bottom:"5px",position:"absolute"}},[s("span",{staticStyle:{cursor:"pointer"},on:{click:function(s){return e.getParticipationUsersInfo(t,"employees")}}},[e._v(e._s(t.cascadeOnEmployees.length)+" "+e._s(e.localize.SUB_EMPLOYEES))]),s("span",{staticStyle:{cursor:"pointer",margin:"0 0 0 5px","vertical-align":"middle"},on:{click:function(s){return e.cleanCascadeUsers(t,"employees")}}},[s("svg",{attrs:{width:"8",height:"9",viewBox:"0 0 8 9",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[s("path",{attrs:{d:"M4.94151 4.50001L7.53917 1.90235C7.66246 1.77929 7.7318 1.61229 7.73196 1.43809C7.73211 1.26389 7.66306 1.09677 7.53999 0.973486C7.41692 0.850202 7.24992 0.780855 7.07573 0.780701C6.90153 0.780547 6.73441 0.849599 6.61112 0.972666L4.01347 3.57032L1.41581 0.972666C1.29253 0.849381 1.12532 0.780121 0.950968 0.780121C0.776617 0.780121 0.609408 0.849381 0.486124 0.972666C0.36284 1.09595 0.293579 1.26316 0.293579 1.43751C0.293579 1.61186 0.36284 1.77907 0.486124 1.90235L3.08378 4.50001L0.486124 7.09767C0.36284 7.22095 0.293579 7.38816 0.293579 7.56251C0.293579 7.73686 0.36284 7.90407 0.486124 8.02735C0.609408 8.15064 0.776617 8.2199 0.950968 8.2199C1.12532 8.2199 1.29253 8.15064 1.41581 8.02735L4.01347 5.4297L6.61112 8.02735C6.73441 8.15064 6.90162 8.2199 7.07597 8.2199C7.25032 8.2199 7.41753 8.15064 7.54081 8.02735C7.6641 7.90407 7.73336 7.73686 7.73336 7.56251C7.73336 7.38816 7.6641 7.22095 7.54081 7.09767L4.94151 4.50001Z",fill:"#D9D9D9"}})])])])])])]):e._e(),0===t.cascadeOnEmployees.length?s("div",{staticStyle:{"margin-top":"10px"}},[s("span",{staticClass:"bp-short-prosess-steps-arrow bp-short-prosess-steps-arrow-running"}),s("div",{staticClass:"add-faces",on:{click:function(s){return e.checkAccessTo("employees",t)}}},[s("svg",{attrs:{width:"34",height:"34",viewBox:"0 0 34 34",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[s("rect",{attrs:{x:"0.793579",y:"0.5",width:"31",height:"31",rx:"15.5",stroke:"#A5ADB3"}}),s("svg",{attrs:{width:"30",height:"30",viewBox:"-8 -8 30 30",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[s("path",{attrs:{d:"M8.00012 15V8M8.00012 8V1M8.00012 8H15.0001M8.00012 8H1.00012",stroke:"#A5ADB3","stroke-linecap":"round"}})])]),s("span",{staticClass:"process-step-more",staticStyle:{position:"relative",bottom:"15px"}},[s("span",{staticStyle:{cursor:"pointer",color:"#535C69"}},[e._v(e._s(e.localize.SUB_EMPLOYEES))]),s("span",{staticStyle:{cursor:"pointer",margin:"0 0 0 5px","vertical-align":"middle"}})])])]):e._e()])]):e._e(),"Y"===e.userInfo.IS_BOSS&&"Y"===e.userInfo.HAVE_SUBORDINATE_BOSSES&&"N"===e.userInfo.HAVE_SUBORDINATE_EMPLOYEES?s("div",[t.cascadeOnBosses.length>0?s("div",[s("div",[s("span",{staticClass:"bp-short-prosess-steps-arrow bp-short-prosess-steps-arrow-running"}),s("a",{staticClass:"bp-short-process-step bp-short-process-step-more"},[s("div",{staticClass:"bp-short-process-step-inner ui-icon ui-icon-common-user"},[e.usersAvatars[Object.values(t.cascadeOnBosses)[0]]?s("i",{style:{backgroundImage:"url("+e.usersAvatars[Object.values(t.cascadeOnBosses)[0]]+")"}}):s("i")]),s("span",{staticClass:"process-step-more",staticStyle:{left:"40px",bottom:"5px",position:"absolute"},attrs:{href:"#"}},[s("span",{staticStyle:{cursor:"pointer"},on:{click:function(s){return e.getParticipationUsersInfo(t,"bosses")}}},[e._v(e._s(t.cascadeOnBosses.length)+" "+e._s(e.localize.SUB_BOSSES))]),s("span",{staticStyle:{cursor:"pointer",margin:"0 0 0 5px","vertical-align":"middle"},on:{click:function(s){return e.cleanCascadeUsers(t,"bosses")}}},[s("svg",{attrs:{width:"8",height:"9",viewBox:"0 0 8 9",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[s("path",{attrs:{d:"M4.94151 4.50001L7.53917 1.90235C7.66246 1.77929 7.7318 1.61229 7.73196 1.43809C7.73211 1.26389 7.66306 1.09677 7.53999 0.973486C7.41692 0.850202 7.24992 0.780855 7.07573 0.780701C6.90153 0.780547 6.73441 0.849599 6.61112 0.972666L4.01347 3.57032L1.41581 0.972666C1.29253 0.849381 1.12532 0.780121 0.950968 0.780121C0.776617 0.780121 0.609408 0.849381 0.486124 0.972666C0.36284 1.09595 0.293579 1.26316 0.293579 1.43751C0.293579 1.61186 0.36284 1.77907 0.486124 1.90235L3.08378 4.50001L0.486124 7.09767C0.36284 7.22095 0.293579 7.38816 0.293579 7.56251C0.293579 7.73686 0.36284 7.90407 0.486124 8.02735C0.609408 8.15064 0.776617 8.2199 0.950968 8.2199C1.12532 8.2199 1.29253 8.15064 1.41581 8.02735L4.01347 5.4297L6.61112 8.02735C6.73441 8.15064 6.90162 8.2199 7.07597 8.2199C7.25032 8.2199 7.41753 8.15064 7.54081 8.02735C7.6641 7.90407 7.73336 7.73686 7.73336 7.56251C7.73336 7.38816 7.6641 7.22095 7.54081 7.09767L4.94151 4.50001Z",fill:"#D9D9D9"}})])])])])])]):e._e(),0===t.cascadeOnBosses.length?s("div",{staticStyle:{"margin-top":"10px"}},[s("span",{staticClass:"bp-short-prosess-steps-arrow bp-short-prosess-steps-arrow-running"}),s("div",{staticClass:"add-faces",on:{click:function(s){return e.checkAccessTo("bosses",t)}}},[s("svg",{attrs:{width:"34",height:"34",viewBox:"0 0 34 34",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[s("rect",{attrs:{x:"0.793579",y:"0.5",width:"31",height:"31",rx:"15.5",stroke:"#A5ADB3"}}),s("svg",{attrs:{width:"30",height:"30",viewBox:"-8 -8 30 30",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[s("path",{attrs:{d:"M8.00012 15V8M8.00012 8V1M8.00012 8H15.0001M8.00012 8H1.00012",stroke:"#A5ADB3","stroke-linecap":"round"}})])]),s("span",{staticClass:"process-step-more",staticStyle:{position:"relative",bottom:"15px"}},[s("span",{staticStyle:{cursor:"pointer",color:"#535C69"}},[e._v(e._s(e.localize.SUB_BOSSES))]),s("span",{staticStyle:{cursor:"pointer",margin:"0 0 0 5px","vertical-align":"middle"}})])])]):e._e()]):e._e(),"Y"===e.userInfo.IS_BOSS&&"N"===e.userInfo.HAVE_SUBORDINATE_BOSSES&&"Y"===e.userInfo.HAVE_SUBORDINATE_EMPLOYEES?s("div",[t.cascadeOnEmployees.length>0?s("div",[s("div",[s("span",{staticClass:"bp-short-prosess-steps-arrow bp-short-prosess-steps-arrow-running"}),s("a",{staticClass:"bp-short-process-step bp-short-process-step-more"},[s("div",{staticClass:"bp-short-process-step-inner ui-icon ui-icon-common-user"},[e.usersAvatars[Object.values(t.cascadeOnEmployees)[0]]?s("i",{style:{backgroundImage:"url("+e.usersAvatars[Object.values(t.cascadeOnEmployees)[0]]+")"}}):s("i")]),s("span",{staticClass:"process-step-more",staticStyle:{left:"40px",bottom:"5px",position:"absolute"},attrs:{href:"#"}},[s("span",{staticStyle:{cursor:"pointer"},on:{click:function(s){return e.getParticipationUsersInfo(t,"employees")}}},[e._v(e._s(t.cascadeOnEmployees.length)+" "+e._s(e.localize.SUB_EMPLOYEES))]),s("span",{staticStyle:{cursor:"pointer",margin:"0 0 0 5px","vertical-align":"middle"},on:{click:function(s){return e.cleanCascadeUsers(t,"employees")}}},[s("svg",{attrs:{width:"8",height:"9",viewBox:"0 0 8 9",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[s("path",{attrs:{d:"M4.94151 4.50001L7.53917 1.90235C7.66246 1.77929 7.7318 1.61229 7.73196 1.43809C7.73211 1.26389 7.66306 1.09677 7.53999 0.973486C7.41692 0.850202 7.24992 0.780855 7.07573 0.780701C6.90153 0.780547 6.73441 0.849599 6.61112 0.972666L4.01347 3.57032L1.41581 0.972666C1.29253 0.849381 1.12532 0.780121 0.950968 0.780121C0.776617 0.780121 0.609408 0.849381 0.486124 0.972666C0.36284 1.09595 0.293579 1.26316 0.293579 1.43751C0.293579 1.61186 0.36284 1.77907 0.486124 1.90235L3.08378 4.50001L0.486124 7.09767C0.36284 7.22095 0.293579 7.38816 0.293579 7.56251C0.293579 7.73686 0.36284 7.90407 0.486124 8.02735C0.609408 8.15064 0.776617 8.2199 0.950968 8.2199C1.12532 8.2199 1.29253 8.15064 1.41581 8.02735L4.01347 5.4297L6.61112 8.02735C6.73441 8.15064 6.90162 8.2199 7.07597 8.2199C7.25032 8.2199 7.41753 8.15064 7.54081 8.02735C7.6641 7.90407 7.73336 7.73686 7.73336 7.56251C7.73336 7.38816 7.6641 7.22095 7.54081 7.09767L4.94151 4.50001Z",fill:"#D9D9D9"}})])])])])])]):e._e(),0===t.cascadeOnEmployees.length?s("div",{staticStyle:{"margin-top":"10px"}},[s("span",{staticClass:"bp-short-prosess-steps-arrow bp-short-prosess-steps-arrow-running"}),s("div",{staticClass:"add-faces",on:{click:function(s){return e.checkAccessTo("employees",t)}}},[s("svg",{attrs:{width:"34",height:"34",viewBox:"0 0 34 34",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[s("rect",{attrs:{x:"0.793579",y:"0.5",width:"31",height:"31",rx:"15.5",stroke:"#A5ADB3"}}),s("svg",{attrs:{width:"30",height:"30",viewBox:"-8 -8 30 30",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[s("path",{attrs:{d:"M8.00012 15V8M8.00012 8V1M8.00012 8H15.0001M8.00012 8H1.00012",stroke:"#A5ADB3","stroke-linecap":"round"}})])]),s("span",{staticClass:"process-step-more",staticStyle:{position:"relative",bottom:"15px"}},[s("span",{staticStyle:{cursor:"pointer",color:"#535C69"}},[e._v(e._s(e.localize.SUB_EMPLOYEES))]),s("span",{staticStyle:{cursor:"pointer",margin:"0 0 0 5px","vertical-align":"middle"}})])])]):e._e()]):e._e()])])]):e._e()]),s("td",{staticClass:"block-process-table-column"},[s("div",{attrs:{id:t.signature}})]),s("td",{staticClass:"block-process-table-column"},[s("div",{attrs:{id:t.signature+"_select_project_task"}})]),"N"===t.disableFields?s("td",{staticClass:"block-process-table-column",on:{click:function(t){return e.deleteGoal(a)}}},[s("span",{staticClass:"delete-goal-row"},[e._v("x")])]):e._e()])})),s("tr",[s("td",{staticClass:"block-process-weight-title",attrs:{colspan:"5"}},[e._v(e._s(e.localize.TOTAL_WEIGHT))]),s("td",{staticClass:"block-process-weight-value",class:{"block-process-weight-value-error":100!==e.totalWeight},attrs:{colspan:"5"}},[e._v(e._s(e.totalWeight)+" ")])])],2)]),e.canEdit?s("div",{staticClass:"button-block"},[s("button",{staticClass:"ui-btn ui-btn-primary ui-btn-icon-add crm-btn-toolbar-add",class:{"btn-submit-cancel":e.disableBtn},attrs:{type:"button",disabled:e.disableBtn},on:{click:e.addGoal}},[e._v(e._s(e.localize.ADD_GOAL)+" ")]),s("button",{staticClass:"ui-btn ui-btn-primary",class:{"btn-submit-cancel":e.disableBtnSave},attrs:{type:"button",disabled:e.disableBtnSave},on:{click:e.saveGoals}},[e._v(e._s(e.localize.SAVE_GOALS)+" ")])]):e._e()])},N=[],M=s("53ca"),x=(s("a434"),s("b0c0"),s("25f0"),s("caad"),s("2532"),{name:"GoalsTable",data:function(){return{contentSelect:"",ptSelectors:[]}},computed:Object(i["a"])(Object(i["a"])({},Object(r["b"])(["goals","cardId","canEdit","typeGoals","listGoals","minWeight","userInfo","userProjects","userTasks","userSubordinateEmployees","userSubordinateBosses","usersAvatars","cascadeAccess"])),{},{localize:function(){return Object.freeze({TYPE_GOALS:BX.message("TYPE_GOALS"),GOAL:BX.message("GOAL"),CRITERION:BX.message("CRITERION"),WEIGHT:BX.message("WEIGHT"),DELETE:BX.message("DELETE"),SELECT_TYPE_GOAL:BX.message("SELECT_TYPE_GOAL"),SELECT_GOAL:BX.message("SELECT_GOAL"),TOTAL_WEIGHT:BX.message("TOTAL_WEIGHT"),ADD_GOAL:BX.message("ADD_GOAL"),SAVE_GOALS:BX.message("SAVE_GOALS"),LINK_TASK_PROJECT:BX.message("LINK_TASK_PROJECT"),CASCADE:BX.message("CASCADE"),GOAL_FILE:BX.message("GOAL_FILE"),DEPENDS_ON:BX.message("DEPENDS_ON"),VALUE_FROM:BX.message("VALUE_FROM"),VALUE_TO:BX.message("VALUE_TO"),ATTACH:BX.message("ATTACH"),TASKS:BX.message("TASKS"),PROJECTS:BX.message("PROJECTS"),WARNING_NON_PARTICIPATION:BX.message("WARNING_NON_PARTICIPATION"),WARNING_ACCEPT_DESC:BX.message("WARNING_ACCEPT_DESC"),WARNING_CANCEL_DESC:BX.message("WARNING_CANCEL_DESC"),TASK:BX.message("TASK"),PROJECT:BX.message("PROJECT"),APPROVE:BX.message("APPROVE"),DECLINE:BX.message("DECLINE"),WARNING_INFO:BX.message("WARNING_INFO"),CASCADE_THIS:BX.message("CASCADE_THIS"),CASCADE_CANCEL:BX.message("CASCADE_CANCEL"),SUB_BOSSES:BX.message("SUB_BOSSES"),SUB_EMPLOYEES:BX.message("SUB_EMPLOYEES")})},totalWeight:function(){var e=0;return this.goals.forEach((function(t){e+=parseInt(t.weight)?parseInt(t.weight):0})),e},disableBtn:function(){return this.goals.length>=5},disableBtnSave:function(){var e=this,t=0,s=!1;return this.goals.forEach((function(a){(parseInt(a.weight)<e.minWeight||parseInt(a.weight)>100||a.goal&&0===a.goal.length||a.task&&0===a.task.length||0===a.criterion.length)&&(s=!0),t+=parseInt(a.weight)?parseInt(a.weight):0})),100!==t||s||this.goals.length>5}}),mounted:function(){setTimeout(this.initSelector,100),this.synchronizeCascadeAccess()},methods:{initSelector:function(){var e=this;this.goals.forEach((function(t){e.getSelector(t.signature,t.disableFields,t.depend),e.getProjectTaskSelector(t.signature+"_select_project_task",t.disableFields,t.related)}))},getSelector:function(e,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];BX.ajax({url:templateFolder+"/select.php",data:{id:e,disableFields:t,depend:s,isDep:1},dataType:"html",method:"POST",timeout:30,async:!1,processData:!0,scriptsRunFirst:!1,cache:!1,onsuccess:function(s){if(BX(e).innerHTML=s,"Y"===t){var a=BX(e).querySelector("span.ui-tile-selector-select-container");a.remove()}},onfailure:function(e){console.log(e)}})},getProjectTaskSelector:function(e,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=this,o=new BX.UI.EntitySelector.TagSelector({id:e,readonly:"Y"===t,events:{onAfterTagAdd:function(t){var s=t.data.tag;a.goals.forEach((function(t,a){t.signature+"_select_project_task"===e&&"task"===s.entityType&&t.related.push("task_"+s.id),t.signature+"_select_project_task"===e&&"project"===s.entityType&&t.related.push("project_"+s.id)}))},onAfterTagRemove:function(e){var t=e.data.tag;a.goals.forEach((function(e){e.related.forEach((function(s,a){"object"===Object(M["a"])(s)?t.entityId===s.entityId&&e.related.splice(a,1):t.entityId===s&&e.related.splice(a,1)}))}))}},dialogOptions:{id:e+"_dialog",context:"linked",items:a.userProjects.concat(a.userTasks),selectedItems:s||[],preselectedItems:[],undeselectedItems:[],tabs:[{id:"task",title:a.localize.TASKS},{id:"project",title:a.localize.PROJECTS}],popupOptions:[],multiple:!0,preload:!1,dropdownMode:!0,enableSearch:!1,searchOptions:{allowCreateItem:!1},searchTabOptions:[],recentTabOptions:[],tagSelectorOptions:[],events:{},hideOnSelect:!1,hideOnDeselect:!1,clearSearchOnSelect:!0,width:565,height:420,autoHide:!0,hideByEsc:!0,offsetTop:5,offsetLeft:0,cacheable:!0,focusOnFirst:!1,footer:"",footerOptions:{},showAvatars:!1,compactView:!0,clearUnavailableItems:!0}});a.ptSelectors.push(o),o.renderTo(BX(e))},loadFile:function(e,t){var s=this,a=new FormData;if(e.target.files&&e.target.files[0]){var o=e.target.files[0];a.append("file",o,o.name),BX.ajax.runComponentAction("ithive.goalsbazhen:edit.card.goals","saveFile",{mode:"class",dataType:"json",data:a}).then((function(e){s.goals[t]["file"]={id:e.data.id,name:o.name,path:e.data.path}})).catch((function(e){console.log(e)}))}},deleteFile:function(e){var t=this;BX.ajax.runComponentAction("ithive.goalsbazhen:edit.card.goals","deleteFile",{mode:"class",dataType:"json",data:{id:this.goals[e]["file"]}}).then((function(){t.goals[e]["file"]=""})).catch((function(e){console.log(e)}))},clearGoalTask:function(e){this.goals[e]["goal"]="",this.goals[e]["task"]="",this.synchronizeCascadeAccess()},checkGoalWeight:function(e,t){var s=this.listGoals[this.goals[t].type_goal],a=e.target.value,o=s[a].PROPERTY_WEIGHT_GOALS_VALUE;o>0?(this.goals[t].weight=o,this.goals[t].categoryWeight=o):(this.goals[t].weight=10,this.goals[t].categoryWeight=null),this.synchronizeCascadeAccess()},checkMinGoalWeight:function(e,t){var s=this.getActiveCategoryWeightGoal(t);s=parseInt(s),s>0&&parseInt(this.goals[t].weight)<s&&(this.goals[t].weight=s)},getActiveCategoryWeightGoal:function(e){return this.goals[e].categoryWeight},addGoal:function(){var e=Math.random().toString(36).substring(7);this.goals.push({type_goal:"",goal:"",task:"",criterion:"",weight:this.minWeight,file:"",depend:[],related:[],canCascade:"N",cascadeOnEmployees:[],cascadeOnBosses:[],cascadeSource:"0",disableFields:"N",signature:e}),this.$nextTick((function(){setTimeout(this.getSelector,100,e),setTimeout(this.getProjectTaskSelector,100,e+"_select_project_task")}))},deleteGoal:function(e){this.goals.splice(e,1)},saveGoals:function(){var e=this;event.preventDefault();var t=window.top.BX.SidePanel.Instance.getTopSlider();t.showLoader(),this.goals.forEach((function(t){var s=BX.findChildren(BX(t.signature),{tag:"input",property:{name:t.signature+"[]"}},!0,!0);t.depend=[],s.forEach((function(e){t.depend.push(e.value)}));var a=e;a.ptSelectors.forEach((function(e){e.id===t.signature+"_select_project_task"&&(t.related=[],e.tags.length>0?e.tags.forEach((function(e){switch(e.entityType){case"task":t.related.push("task_"+e.id);break;case"project":t.related.push("project_"+e.id);break}})):t.related=!1)}))})),window.top.BX.ajax.runComponentAction("ithive.goalsbazhen:edit.card.goals","saveGoals",{mode:"class",data:{params:{cardId:this.cardId,goals:this.goals,userId:this.userInfo.ID}}}).then((function(){t.closeLoader();var e=window.top.BX.Main.gridManager.data[0].id;window.top.BX.Main.gridManager.getById(e).instance.reloadTable("POST",{apply_filter:"Y",clear_nav:"Y"})})).catch((function(){t.closeLoader()}))},synchronizeCascadeAccess:function(){var e=this.goals,t=void 0===this.cascadeAccess?[]:this.cascadeAccess,s=0;for(var a in this.typeGoals)"strategy"===this.typeGoals[a].xml_id&&(s=this.typeGoals[a].id);e.forEach((function(e){t.includes(e.goal)?e.canCascade="Y":""!==e.goal&&"0"!==e.goal||e.type_goal===s?(e.canCascade="N",e.cascadeOnEmployees=[],e.cascadeOnBosses=[]):e.canCascade="Y"}))},getParticipationUsersInfo:function(e,t){var s=this;window.top.BX.ajax.runComponentAction("ithive.goalsbazhen:edit.card.goals","getUsersFullName",{mode:"class",data:{users:"bosses"===t?e.cascadeOnBosses:e.cascadeOnEmployees}}).then((function(a){var o='\n            <div style="display: grid; margin: 10px">\n            ';for(var n in a.data)o+='\n              <div style="display: inline-flex">\n              <a class="bp-short-process-step bp-short-process-step-firs" style="margin: 0 0 10px 0">\n              <div class="bp-short-process-step-inner ui-icon ui-icon-common-user">\n              <i style="background-image: url(\''.concat(s.usersAvatars[n],'\')"></i>\n              </div>\n              <a class="process-step-more" href="/company/personal/user/').concat(n,'/" style="margin: 6px 0 0 14px">').concat(a.data[n],'</a>\n              <span\n              class="js_remove_user_cascade"\n              data-user="').concat(n,'"\n              data-logic="').concat(t,'"\n              data-signature="').concat(e.signature,'"\n              style="cursor: pointer; margin: 10px 0 0 10px; vertical-align: middle;">\n                <svg width="8" height="9" viewBox="0 0 8 9" fill="none" xmlns="http://www.w3.org/2000/svg">\n                    <path d="M4.94151 4.50001L7.53917 1.90235C7.66246 1.77929 7.7318 1.61229 7.73196 1.43809C7.73211 1.26389 7.66306 1.09677 7.53999 0.973486C7.41692 0.850202 7.24992 0.780855 7.07573 0.780701C6.90153 0.780547 6.73441 0.849599 6.61112 0.972666L4.01347 3.57032L1.41581 0.972666C1.29253 0.849381 1.12532 0.780121 0.950968 0.780121C0.776617 0.780121 0.609408 0.849381 0.486124 0.972666C0.36284 1.09595 0.293579 1.26316 0.293579 1.43751C0.293579 1.61186 0.36284 1.77907 0.486124 1.90235L3.08378 4.50001L0.486124 7.09767C0.36284 7.22095 0.293579 7.38816 0.293579 7.56251C0.293579 7.73686 0.36284 7.90407 0.486124 8.02735C0.609408 8.15064 0.776617 8.2199 0.950968 8.2199C1.12532 8.2199 1.29253 8.15064 1.41581 8.02735L4.01347 5.4297L6.61112 8.02735C6.73441 8.15064 6.90162 8.2199 7.07597 8.2199C7.25032 8.2199 7.41753 8.15064 7.54081 8.02735C7.6641 7.90407 7.73336 7.73686 7.73336 7.56251C7.73336 7.38816 7.6641 7.22095 7.54081 7.09767L4.94151 4.50001Z" fill="#D9D9D9">\n                    </path>\n                    </svg>\n                </span>\n              </div>\n              ');o+="</div>";var i=BX.PopupWindowManager.create("users_participation_"+t,BX("users_participation_"+t),{content:o,zIndex:100,closeIcon:{opacity:1},closeByEsc:!0,darkMode:!1,autoHide:!0,draggable:!1,resizable:!1,width:300,lightShadow:!0,angle:!1,overlay:{backgroundColor:"black",opacity:500},buttons:[],events:{onPopupShow:function(){s.addAbilityRemoveCascadeUser(i)},onPopupClose:function(){i.destroy()}}});i.show()})).catch((function(e){console.log(e)}))},cleanCascadeUsers:function(e,t){switch(t){case"bosses":e.cascadeOnBosses=[];break;case"employees":e.cascadeOnEmployees=[];break}},checkAccessTo:function(e,t){var s=this,a=this;a.ptSelectors.forEach((function(e){e.id===t.signature+"_select_project_task"&&(t.related=[],e.tags.length>0?e.tags.forEach((function(e){switch(e.entityType){case"task":t.related.push("task_"+e.id);break;case"project":t.related.push("project_"+e.id);break}})):t.related=!1)})),BX.ajax.runComponentAction("ithive.goalsbazhen:edit.card.goals","checkUsersParticipation",{mode:"class",data:{logic:e,currentCardUserId:s.userInfo.ID,related:t.related?t.related:[]}}).then((function(a){var o='\n              <div style="display: grid">\n                <div class="notification_alert">\n\n                <div class="notification_alert__title">\n                    '.concat(s.localize.WARNING_NON_PARTICIPATION,"\n                </div>\n              ");o+='\n                <div class="notification_alert__warning">\n                  '.concat(s.localize.WARNING_INFO,"\n              </div>\n              "),o+="\n              </div></div></div>\n              ";var n=BX.PopupWindowManager.create("users_none_participation",BX("users_none_participation"),{content:o,zIndex:100,darkMode:!1,draggable:!1,resizable:!1,width:600,lightShadow:!0,angle:!1,overlay:{backgroundColor:"black",opacity:70},buttons:[new BX.PopupWindowButton({text:s.localize.CASCADE_THIS,className:"ui-btn ui-btn-primary",events:{click:function(){switch(e){case"bosses":t.cascadeOnBosses=a.data.USERS;break;case"employees":t.cascadeOnEmployees=a.data.USERS;break}n.destroy()}}}),new BX.PopupWindowButton({text:s.localize.CASCADE_CANCEL,className:"ui-btn ui-btn-outline",events:{click:function(){n.destroy()}}})],events:{onPopupShow:function(){},onPopupClose:function(){n.destroy()}}});n.show()})).catch((function(e){console.log(e)}))},addAbilityRemoveCascadeUser:function(e){var t=this,s=e.contentContainer.querySelectorAll("span.js_remove_user_cascade");s.forEach((function(s){s.addEventListener("click",(function(){t.removeCascadeUser(e,s)}))}))},removeCascadeUser:function(e,t){var s=this,a=t.dataset.user,o=t.dataset.logic,n=t.dataset.signature;s.goals.forEach((function(s){if(s.signature===n)switch(o){case"bosses":s.cascadeOnBosses.forEach((function(o,n){o===a&&(s.cascadeOnBosses.splice(n,1),0===s.cascadeOnBosses.length?e.destroy():t.parentNode.remove())}));break;case"employees":s.cascadeOnEmployees.forEach((function(o,n){o===a&&(s.cascadeOnEmployees.splice(n,1),0===s.cascadeOnEmployees.length?e.destroy():t.parentNode.remove())}));break}}))}}}),G=x,X=Object(u["a"])(G,D,N,!1,null,null,null),R=X.exports,z=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("table",{staticClass:"log-table"},[s("tr",[s("td",{staticClass:"log-table-head"},[e._v(e._s(e.localize.DATA))]),s("td",{staticClass:"log-table-head"},[e._v(e._s(e.localize.AUTHOR))]),s("td",{staticClass:"log-table-head"},[e._v(e._s(e.localize.TYPE))]),s("td",{staticClass:"log-table-head"},[e._v(e._s(e.localize.DESCRIPTION))]),s("td",{staticClass:"log-table-head"},[e._v(e._s(e.localize.COMMENT))])]),e._l(e.logs,(function(t,a){return s("tr",{key:"log_"+a},[s("td",{staticClass:"log-table-column"},[e._v(e._s(t.MODIFIED))]),s("td",{staticClass:"log-table-column"},[e._v(e._s(t.MODIFIED_BY))]),s("td",{staticClass:"log-table-column"},[e._v(e._s(t.ACTION_NAME))]),s("td",{staticClass:"log-table-column"},[e._v(e._s(t.ACTION_TITLE))]),s("td",{staticClass:"log-table-column"},[e._v(e._s(t.ACTION_NOTE))])])}))],2)},U=[],j={name:"Logs",computed:Object(i["a"])(Object(i["a"])({},Object(r["b"])(["logs"])),{},{localize:function(){return Object.freeze({DATA:BX.message("DATA"),AUTHOR:BX.message("AUTHOR"),TYPE:BX.message("TYPE"),DESCRIPTION:BX.message("DESCRIPTION"),COMMENT:BX.message("COMMENT")})}})},Y=j,W=Object(u["a"])(Y,z,U,!1,null,null,null),H=W.exports,V={name:"App",components:{HeadTitle:E,HeadStages:f,HeadInfo:k,GoalsTable:R,Logs:H},data:function(){return{comment:"",stageToChange:"",activeTab:"goals"}},computed:Object(i["a"])(Object(i["a"])({},Object(r["b"])(["goals","cardId","canEdit","statusGoals","isDraftStage","isApprovalStage","activeStage","minWeight","isAdmin","usersAvatars"])),{},{localize:function(){return Object.freeze({GOALS:BX.message("GOALS"),HISTORY:BX.message("HISTORY"),SEND_AGREE:BX.message("SEND_AGREE"),DECLINE:BX.message("DECLINE"),APPROVE:BX.message("APPROVE"),NOT_APPROVE:BX.message("NOT_APPROVE"),AGREE:BX.message("AGREE"),NOT_AGREE:BX.message("NOT_AGREE"),COMMENT:BX.message("COMMENT"),SEND:BX.message("SEND"),SELECT_STAGE:BX.message("SELECT_STAGE"),LINK_TASK_PROJECT:BX.message("LINK_TASK_PROJECT"),CASCADE:BX.message("CASCADE"),INTRODUCED:BX.message("INTRODUCED"),EMPLOYEES_NOT_ACCESS_GOALS:BX.message("EMPLOYEES_NOT_ACCESS_GOALS"),TO_MODULE_ADMINS:BX.message("TO_MODULE_ADMINS"),SUB_BOSSES:BX.message("SUB_BOSSES"),SUB_EMPLOYEES:BX.message("SUB_EMPLOYEES")})},activeSort:function(){for(var e=Object.values(this.statusGoals),t=0;t<e.length;t++)if(e[t].id===this.activeStage)return e[t].sort},disableBtn:function(){var e=this,t=0,s=!1;return this.goals.forEach((function(a){(parseInt(a.weight)<e.minWeight||parseInt(a.weight)>100||a.goal&&0===a.goal.length||a.task&&0===a.task.length||0===a.criterion.length)&&(s=!0),t+=parseInt(a.weight)?parseInt(a.weight):0})),100!==t||s||this.goals.length>5}}),methods:{sendAgreement:function(){var e=this,t=this,s=window.top.BX.SidePanel.Instance.getTopSlider();this.goals.forEach((function(e){var t=BX.findChildren(BX(e.signature),{tag:"input",property:{name:e.signature+"[]"}},!0,!0);e.depend=[],t.forEach((function(t){e.depend.push(t.value)}))})),window.top.BX.ajax.runComponentAction("ithive.goalsbazhen:edit.card.goals","nextStatus",{mode:"class",data:{params:{cardId:this.cardId,goals:this.goals,activeStage:this.activeStage}}}).then((function(e){var s;if("Y"===(null===(s=e.data)||void 0===s?void 0:s.needShowWarningPopup)){var a="";for(var o in a+='\n                <div style="display: grid">\n                <div class="notification_alert">\n\n                <div class="notification_alert__title">\n                    '.concat(t.localize.EMPLOYEES_NOT_ACCESS_GOALS,'\n                </div>\n                  <div class="notification_alert__warning">\n              '),e.data)Number(o)&&(a+="\n                    ".concat(e.data[o].title,"<br>\n                 "));for(var n in a+='\n              <br><div style="display: grid; margin: 10px">\n              '.concat(t.localize.TO_MODULE_ADMINS,"\n              "),e.data.moduleAdmins)a+='\n                    <div style="display: inline-flex; margin-top: 10px">\n                    <a class="bp-short-process-step bp-short-process-step-firs" style="margin: 0 0 10px 0">\n                    <div class="bp-short-process-step-inner ui-icon ui-icon-common-user">\n                    <i style="background-image: url(\''.concat(t.usersAvatars[n],'\')"></i>\n                    </div>\n                    <a class="process-step-more" href="/company/personal/user/').concat(n,'/" style="margin: 6px 0 0 14px">').concat(e.data.moduleAdmins[n],"</a>\n                    </div>\n                 ");a+="\n                </div></div>\n              </div></div></div>\n              ";var i=BX.PopupWindowManager.create("users_none_access_to_goals",BX("users_none_access_to_goals"),{content:a,zIndex:100,darkMode:!1,draggable:!1,resizable:!1,width:700,lightShadow:!0,angle:!1,overlay:{backgroundColor:"black",opacity:70},buttons:[new BX.PopupWindowButton({text:t.localize.INTRODUCED,className:"ui-btn ui-btn-primary",events:{click:function(){i.close()}}})],events:{onPopupShow:function(){},onPopupClose:function(){i.destroy()}}});i.show()}else{window.top.BX.SidePanel.Instance.close();var c=window.top.BX.Main.gridManager.data[0].id;window.top.BX.Main.gridManager.getById(c).instance.reloadTable("POST",{apply_filter:"Y",clear_nav:"Y"})}})).catch((function(t){t.errors[0]&&e.showError(t.errors[0].message),s.closeLoader();var a=window.top.BX.Main.gridManager.data[0].id;window.top.BX.Main.gridManager.getById(a).instance.reloadTable("POST",{apply_filter:"Y",clear_nav:"Y"})}))},showError:function(e){var t=new window.BX.PopupWindow("error",window.body,{closeIcon:{right:"20px",top:"10px"},titleBar:{content:BX.create("span",{html:BX.message("ERROR_TITLE"),props:{className:"error-dialog-title"}})},autoHide:!0,zIndex:5e3,offsetTop:1,offsetLeft:0,lightShadow:!0,closeByEsc:!0,overlay:{backgroundColor:"grey",opacity:"80"}});t.setContent(e),t.show()},openModalComment:function(){var e=new window.BX.PopupWindow("call-decline",window.body,{closeIcon:{right:"20px",top:"10px"},titleBar:{content:window.BX.create("span",{html:BX.message("SET_COMMENT"),props:{className:"call-decline-title"}})},autoHide:!0,zIndex:5e3,offsetTop:1,offsetLeft:0,lightShadow:!0,closeByEsc:!0,overlay:{backgroundColor:"grey",opacity:"80"}});e.setContent(window.BX("commentPopup")),e.show()},sendDecline:function(){var e=this,t=window.top.BX.SidePanel.Instance.getTopSlider();t.showLoader(),window.top.BX.ajax.runComponentAction("ithive.goalsbazhen:edit.card.goals","prevStatus",{mode:"class",data:{params:{cardId:this.cardId,goals:this.goals,stageToChange:this.stageToChange,activeStage:this.activeStage,comment:this.comment}}}).then((function(){window.top.BX.SidePanel.Instance.close();var e=window.top.BX.Main.gridManager.data[0].id;window.top.BX.Main.gridManager.getById(e).instance.reloadTable("POST",{apply_filter:"Y",clear_nav:"Y"})})).catch((function(s){s.errors[0]&&e.showError(s.errors[0].message),t.closeLoader();var a=window.top.BX.Main.gridManager.data[0].id;window.top.BX.Main.gridManager.getById(a).instance.reloadTable("POST",{apply_filter:"Y",clear_nav:"Y"})}))},closeSlider:function(){window.top.BX.SidePanel.Instance.close()}}},F=V,K=Object(u["a"])(F,o,n,!1,null,null,null),$=K.exports;a["a"].use(r["a"]);var J=window.jsParams,Z=[];J.ITEM.GOALS.length&&J.ITEM.GOALS.forEach((function(e){e.signature=Math.random().toString(36).substring(7),e.canCascade="N",Z.push(e)}));var q=new r["a"].Store({state:{goals:Z,selectorId:J.ITEM.SELECTOR_ID,processInfo:J.ITEM.PROCESS_INFO,userInfo:J.ITEM.USER_INFO,delegateInfo:J.ITEM.DELEGATE_INFO,typeGoals:J.ITEM.TYPE_GOALS,listGoals:J.ITEM.LIST_GOALS,statusGoals:J.ITEM.STATUS_GOALS,activeStage:J.ITEM.ACTIVE_STAGE,cardId:J.ITEM.ID,isDraftStage:J.ITEM.IS_DRAFT_STAGE,isApprovalStage:J.ITEM.IS_APPROVAL_STAGE,isCompleteStage:J.ITEM.IS_COMPLETE_STAGE,logs:J.ITEM.LOGS,canEdit:J.ITEM.CAN_EDIT,canEditDelegate:J.ITEM.CAN_EDIT_DELEGATE,isAdmin:J.ITEM.IS_ADMIN,minWeight:parseInt(J.ITEM.MIN_WEIGHT),userProjects:J.ITEM.AVAILABLE_PROJECTS,userTasks:J.ITEM.AVAILABLE_TASKS,userSubordinateEmployees:J.ITEM.SUBORDINATE_EMPLOYEES,userSubordinateBosses:J.ITEM.SUBORDINATE_BOSSES,usersAvatars:J.ITEM.USERS_AVATARS,cascadeAccess:J.ITEM.CASCADE_ACCESS}});a["a"].config.productionTip=!1,new a["a"]({render:function(e){return e($)},store:q}).$mount("#edit_card")}});